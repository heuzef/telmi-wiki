{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Telmi Wiki \u2728 Partage de connaissance de la communaut\u00e9 Telmi ! Que trouve t'on ici ? Des informations pratiques, des ressources, des astuces, etc ... Tous ce que la communaut\u00e9 de parent r\u00e9unis depuis des ann\u00e9es sur Discord ! Comment contribuer sur ce wiki ? Les pages de ce Wiki peuvent \u00eatre r\u00e9dig\u00e9s et soumise \u00e0 la communaut\u00e9 pour integration. Le format de fichier est en Markdown, vous pouvez utiliser un \u00e9diteur pour r\u00e9diger votre contenu, comme StackEdit par exemple. Vous pouvez ensuite partager vos fichiers \u00e0 la communaut\u00e9 sur Discord , ou pour les plus exp\u00e9riment\u00e9s, soumettre une Pull Request sur le d\u00e9p\u00f4t Github Telmi-Wiki .","title":"\u2728 Accueil"},{"location":"#telmi-wiki","text":"Partage de connaissance de la communaut\u00e9 Telmi !","title":"Telmi Wiki \u2728"},{"location":"#que-trouve-ton-ici","text":"Des informations pratiques, des ressources, des astuces, etc ... Tous ce que la communaut\u00e9 de parent r\u00e9unis depuis des ann\u00e9es sur Discord !","title":"Que trouve t'on ici ?"},{"location":"#comment-contribuer-sur-ce-wiki","text":"Les pages de ce Wiki peuvent \u00eatre r\u00e9dig\u00e9s et soumise \u00e0 la communaut\u00e9 pour integration. Le format de fichier est en Markdown, vous pouvez utiliser un \u00e9diteur pour r\u00e9diger votre contenu, comme StackEdit par exemple. Vous pouvez ensuite partager vos fichiers \u00e0 la communaut\u00e9 sur Discord , ou pour les plus exp\u00e9riment\u00e9s, soumettre une Pull Request sur le d\u00e9p\u00f4t Github Telmi-Wiki .","title":"Comment contribuer sur ce wiki ?"},{"location":"achats/carte_sd/","text":"Acheter une carte SD","title":"Carte SD"},{"location":"achats/carte_sd/#acheter-une-carte-sd","text":"","title":"Acheter une carte SD"},{"location":"achats/miyoo_mini_plus/","text":"Acheter une Miyoo Mini Plus https://fr.aliexpress.com/w/wholesale-miyoo-mini-plus.html","title":"Miyoo Mini Plus"},{"location":"achats/miyoo_mini_plus/#acheter-une-miyoo-mini-plus","text":"https://fr.aliexpress.com/w/wholesale-miyoo-mini-plus.html","title":"Acheter une Miyoo Mini Plus"},{"location":"international/creer_un_store_international/","text":"Ouvrir un store international Telmi Cette documentation explique en d\u00e9tail comment mettre en production un store Telmi pour h\u00e9berger des packs d'histoire dans une langue \u00e9trang\u00e8re pr\u00e9cise. Elle s'adresse donc \u00e0 vous si : Vous \u00eates bilingue. Vous avez la volont\u00e9 de g\u00e9rer un store Telmi officiel dans une langue \u00e9trang\u00e8re. Vous poss\u00e9dez un compte Github et vous savez comment l'utiliser. Vous \u00eates partant ? Super ! N'h\u00e9sitez pas \u00e0 demander de l'aide \u00e0 la communaut\u00e9 Telmi ! Structure d'un store Telmi Un store Telmi est basiquement un fichier JSON qui est appel\u00e9 sur le logiciel Telmi-Sync, ce dernier contient toutes les informations des packs d'histoire. Il est resynchronis\u00e9 \u00e0 chaque lancement du logiciel. Votre r\u00f4le est donc de faire en sorte que ce fichier JSON soit r\u00e9guli\u00e8rement mis \u00e0 jour et publiquement accessible. Pour cela, deux services sont donc exploit\u00e9s : Github et Deno. Github h\u00e9berge les histoires, les informations et met \u00e0 disposition le fichier JSON du store. Deno de son c\u00f4t\u00e9, sert uniquement \u00e0 d\u00e9clencher la mise \u00e0 jour quotidienne du fichier JSON. La langue Pour commencer, identifiez le code ISO 639-1 du pays concern\u00e9 par votre langue. Par exemple \"FR\", pour la France. \u26a0\ufe0f Dans la suite de cette documentation, c'est le code \"EN\" qui sera pris en exemple, remplacez donc syst\u00e9matiquement ce dernier par votre propre code pays \u26a0\ufe0f Cr\u00e9ation d'une organisation Github Identifiez-vous sur Github puis d\u00e9butez la cr\u00e9ation d'une organisation avec le nom : telmi-store-en Vous pouvez \u00e9galement ajouter quelques \u00e9minents membres de la communaut\u00e9 Telmi en soutient \ud83e\udd2a Commencez \u00e0 personaliser l'organisation : Nom : Telmi Store EN Une description traduite dans votre langue Le lien vers https://telmi.fr Une ic\u00f4ne personnalis\u00e9e avec le drapeau de votre langue, vous pouvez utiliser ce template XCF avec GIMP si besoin pour cr\u00e9er votre ic\u00f4ne. Votre organisation est pr\u00eate, il est temps d'initialiser le premier d\u00e9p\u00f4t .github , c'est un d\u00e9p\u00f4t de configuration sp\u00e9cial. Ajoutez ce dernier en acc\u00e8s public. Ce store doit \u00eatre initialis\u00e9 avec quelques fichiers, dossier et surtout la banni\u00e8re traduite dans votre langue. Pour faire ceci, reprenez la structure des d\u00e9p\u00f4ts existants, par exemple : https://github.com/telmi-store/.github/archive/refs/heads/main.zip https://github.com/telmi-store-en/.github/archive/refs/heads/main.zip https://github.com/telmi-store-cn/.github/archive/refs/heads/main.zip etc ... Pour concevoir la banni\u00e8re, vous pouvez utiliser ce template XCF avec GIMP si besoin pour la concevoir. Voici quelques instructions pour vous aidez \u00e0 initialiser ce d\u00e9p\u00f4t : # R\u00e9cup\u00e9rer le d\u00e9p\u00f4t vide sur en local git clone git@github.com:telmi-store-en/.github.git # Ajoutez-y vos fichiers mv -v mes-fichiers/* .github/ # Poussez les modifications cd .github git add --all git commit -m \"Init repo\" git branch -M main git remote add origin git@github.com:telmi-store-en/.github.git git push -u origin main Une fois votre d\u00e9p\u00f4t .github pr\u00eat, nous pouvons passer \u00e0 la mise en place du fichier GIST. Mise en place d'un GIST Github GIST est la fonctionnalit\u00e9 qui rendra votre fichier JSON visible publiquement. Rendez-vous sur https://gist.github.com pour commencer \u00e0 le cr\u00e9er en cliquant sur Create secret gist . Nommez-le telmi-store-en . Ajouter un simple point pour l'initialiser. Un fichier gistfile1.txt est cr\u00e9\u00e9, renommez-le telmi-interactive-en.json C'est pr\u00eat ! R\u00e9cup\u00e9rez l'URL publique en cliquant sur Share . Votre lien URL ressemblera \u00e0 quelque chose comme ceci : https://gist.github.com/heuzef/c2da96666a3a84397f19576d94d15a57 Ce lien comprend l'ID de votre GIST (ici c2da96666a3a84397f19576d94d15a57 dans cet exemple), notez-le pr\u00e9cieusement. Ainsi, le lien officiel de votre nouveau store sera donc structur\u00e9 ainsi : https://gist.githubusercontent.com/heuzef/c2da96666a3a84397f19576d94d15a57/raw/telmi-interactive-en.json Adaptez ce lien avec votre ID GIST et code pays, vous devriez ainsi pouvoir consulter votre fichier JSON (qui ne contient qu'un point \u00e0 ce stade). C'est \u00e9galement ce lien, que vous pourrez ajouter sur Telmi-Sync. C'est tout bon ? Super ! Nous allons pouvoir commencer la configuration de Deno, qui s'occupera de mettre \u00e0 jour quotidiennement ce fichier JSON. Mais avant cela, il faut lui donner l'autorisation de le faire, nous allons donc cr\u00e9er un Token d'acc\u00e8s d\u00e9di\u00e9. Pour cela, acc\u00e9der \u00e0 la gestion de vos Tokens. Vous pouvez directement commencer la cr\u00e9ation de votre Token via ce lien : https://github.com/settings/tokens/new Donnez-lui un nom parlant, par exemple telmi-store-gists et surtout sp\u00e9cifiez bien que ce dernier n'a pas de date d'expiration . Finalement, pour les permissions (Select scopes), sp\u00e9cifiez uniquement l'acc\u00e8s \u00e0 gist . \u00c0 la cr\u00e9ation, le Token appara\u00eetra en clair, notez-le pr\u00e9cieusement , car vous n'aurez plus acc\u00e8s \u00e0 ce dernier apr\u00e8s. Votre token ressemble \u00e0 ceci : github_pat_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx Ne partagez jamais ce dernier \u00e0 qui que ce soit. Configuration du serveur de synchronisation Deno Deno est un service open-source d'ex\u00e9cution de code Javascript. Nous allons exploiter ce dernier car il dispose d'une fonction CRON , ce qui nous sera fort utile pour ex\u00e9cuter quotidiennement un script TS qui va : Parser les diff\u00e9rents d\u00e9p\u00f4ts de notre organisation sur Github En extraire toutes les informations des packs d'histoire G\u00e9n\u00e9rer le fichier JSON de notre store Pousser ce dernier sur GIST pour forcer son actualisation Vous pouvez donc commencer par vous authentifier sur le site de Deno (avec votre compte Github). Installez ensuite Deno sur votre machine : curl -fsSL https://deno.land/install.sh | sh Puis finalement, installez \u00e9galement l'outil de gestion (CLI) qui nous servira \u00e0 d\u00e9ployer notre projet : deno install -gArf jsr:@deno/deployctl export PATH=\"/home/$USER/.deno/bin:$PATH\" # Definir la variable PATH pour pouvoir executer deployctl Nous allons \u00e0 pr\u00e9sent initialiser le projet, voici \u00e0 quoi doit ressembler votre dossier ce travail : telmi-store-en \u2514\u2500\u2500 src \u2514\u2500\u2500 main.ts mkdir telmi-store-en mkdir telmi-store-en/src touch telmi-store-en/src/main.ts Cr\u00e9er votre fichier main.ts : const strFormat = (str) => str.replace(/[^\\u0020-\\ucfbf\\u000A]+/g, ' ').trim(), imageExists = (url) => { return new Promise((resolve, reject) => { fetch(url, { method: 'HEAD' }) .then((res) => { if (res.status !== 200) { return resolve(false) } resolve(true) }) .catch(() => { resolve(false) }) }) } Deno.serve(() => new Response('API d\\'histoires', { status: 200, headers: { 'content-type': 'text/html; charset=utf-8' } })) const githubToTelmi = async (gist, filename, repoURI, banner, background, link) => { let data = [] const repos = await (await fetch('https://api.github.com/orgs/' + repoURI + '/repos', { headers: { accept: 'application/json' } })).json() for (const repo of repos) { repo.thumbnail = 'https://raw.githubusercontent.com/' + repoURI + '/' + repo.name + '/main/thumbnail.jpg' if (await imageExists(repo.thumbnail)) { repo.releases = await (await fetch(repo.url + '/releases', { headers: { accept: 'application/json' } })).json() } else { repo.releases = [] } } data = repos.reduce( (acc, repo) => { if (!repo.releases.length || !repo.releases[0].assets.length) { return acc } const title = [...repo.description.matchAll(/^\\[([0-9]+)\\+](.*)\\(([A-Z]+)\\)$/g)] if (!title.length) { return acc } const url = repo.releases[0].assets.reduce( (acc, v) => { if (v.browser_download_url.substring(v.browser_download_url.length - 4) === '.zip') { return v.browser_download_url } return acc }, '' ) if (url === '') { return acc } const downloadCount = repo.releases.reduce( (acc, release) => release.assets.reduce((acc, v) => acc + v.download_count, acc), 0 ) const details = repo.releases[0].body.replace('\\r', '').split('\\n').reduce( (acc, line) => { if (line.substring(0, 1) !== '>') { acc.description = acc.description + '\\n' + line return acc } const colonPos = line.indexOf(':', 1) if (colonPos === -1) { acc.description = acc.description + '\\n' + line return acc } return { ...acc, [line.substring(1, colonPos).trim().toLowerCase()]: line.substring(colonPos + 1).trim() } }, { description: '' } ) return [ ...acc, Object.assign({ age: parseInt(strFormat(title[0][1]), 10), title: strFormat(title[0][2]), description: strFormat(details.description), thumbs: { small: repo.thumbnail, medium: repo.thumbnail }, download: strFormat(url), download_count: downloadCount, awards: details.awards !== undefined ? details.awards.substring(1).split('#').map((v) => strFormat(v.trim())) : [], created_at: repo.releases[repo.releases.length - 1].published_at, updated_at: repo.releases[0].published_at }, details.uuid !== undefined ? { uuid: details.uuid } : null, details.author !== undefined ? { author: details.author } : null, details.voice !== undefined ? { voice: details.voice } : null, details.designer !== undefined ? { designer: details.designer } : null, details.publisher !== undefined ? { publisher: details.publisher } : null, details.category !== undefined ? { category: details.category } : null, details.version !== undefined ? { version: details.version } : null, details.license !== undefined ? { license: details.license } : null ) ] }, data ) const dateIso = (new Date()).toISOString().split('T'), date = dateIso[0] + ' ' + dateIso[1].substring(0, 8) await fetch( 'https://api.github.com/gists/' + gist, { method: 'PATCH', headers: { Authorization: 'Bearer github_pat_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', Accept: 'application/vnd.github+json', 'X-GitHub-Api-Version': '2022-11-28', }, body: JSON.stringify({ description: 'Update ' + repoURI + ' (' + date + ')', files: { [filename]: { content: JSON.stringify({ banner: { image: banner, background, link }, data }) } } }) } ) } Deno.cron('telmi-interactive-en', '0 1,13 * * *', async () => { await githubToTelmi('c2da96666a3a84397f19576d94d15a57', 'telmi-interactive-en.json', 'telmi-store-en', 'https://raw.githubusercontent.com/telmi-store-en/.github/master/profile/banner-telmi.jpg', '#2e144b', 'https://discord.gg/ZTA5FyERbg') }) Adaptez ce fichier pour indiquer le Token (Ligne \"Authorization\"), l'ID GIST et le Code pays sur les derni\u00e8res lignes du script. Maintenant que votre fichier main.ts est pr\u00eat, nous pouvons effectuer le d\u00e9ploiement sur Deno : cd telmi-store-en deployctl deploy --prod --project=telmi-store-en --unstable src/main.ts Une demande d'autorisation est demand\u00e9e pour poursuivre. Si le d\u00e9ploiement r\u00e9ussis, vous devriez avoir un service accessible sur un domaine comme par exemple : https://telmi-store-en.deno.dev , mais \u00e9galement un fichier deno.json cr\u00e9\u00e9 par le d\u00e9ploiement. Finalement, RDV sur https://dash.deno.com pour visualiser l'\u00e9tat de l'ex\u00e9cution du script par CRON. Le statut \"Last Run\" doit indiquer \"Succeeded\". Cr\u00e9ation d'un premier pack d'histoire \u26a0\ufe0f La cr\u00e9ation des packs d'histoire doit \u00eatre tr\u00e8s rigoureusement g\u00e9r\u00e9, autrement, l'ex\u00e9cution du script quotidien sur Deno \u00e9chouera si l'un de vos packs d'histoire est mal configur\u00e9, pouvant rendre alors votre store hors service \u26a0\ufe0f Pour que la synchronisation puisse fonctionner, il vous faut initialiser un premier pack d'histoire, afin de voir appara\u00eetre ce dernier sur telmi-sync. Donc c'est parti mon Telmi, retournons sur notre organisation Github, pour cr\u00e9er un nouveau d\u00e9p\u00f4t. Prenez exemple des d\u00e9p\u00f4ts d'histoire existants, par exemple : https://github.com/orgs/telmi-store/repositories Chaque d\u00e9p\u00f4t est structur\u00e9 tr\u00e8s pr\u00e9cis\u00e9ment, donc soyez tr\u00e8s rigoureux, mais globalement, vous y retrouverez la m\u00eame logique de structure avec quelques fichiers \u00e0 modifier. Puis, une fois votre d\u00e9p\u00f4t pr\u00eat, vous pourrez cr\u00e9er une \"Realease\" dans le menu du m\u00eame nom, qui contiendra votre pack d'histoire au format ZIP . Ajouter un nom avec la nomenclature des noms de pack (\u00e2ge, titre, langue) Cr\u00e9er un tag latest pour cette release Ajouter la description, attention au format du contenu, c'est ce dernier qui est analys\u00e9 sur le store Ajouter enfin le pack d'histoire au format ZIP Pour terminer, n'oubliez pas d'ajouter une description \u00e0 votre d\u00e9p\u00f4t, avec le nom du pack d'histoire utilisant la nomenclature des noms de pack (\u00e2ge, titre, langue), autrement, le script planifi\u00e9 par CRON sur Deno sera en \u00e9chec. C'est tout bon, v\u00e9rifiez bien le lendemain que votre nouveau pack d'histoire est correctement visible sur Telmi-Sync, puis r\u00e9p\u00e9ter l'op\u00e9ration pour chaque pack d'histoire \ud83d\udcaa \u26a0\ufe0f Soyez prudent concernant les droits d'auteur, aucun pack d'histoire ill\u00e9gal ne doit \u00eatre mis \u00e0 disposition du public \u26a0\ufe0f","title":"Cr\u00e9er un store international"},{"location":"international/creer_un_store_international/#ouvrir-un-store-international-telmi","text":"Cette documentation explique en d\u00e9tail comment mettre en production un store Telmi pour h\u00e9berger des packs d'histoire dans une langue \u00e9trang\u00e8re pr\u00e9cise. Elle s'adresse donc \u00e0 vous si : Vous \u00eates bilingue. Vous avez la volont\u00e9 de g\u00e9rer un store Telmi officiel dans une langue \u00e9trang\u00e8re. Vous poss\u00e9dez un compte Github et vous savez comment l'utiliser. Vous \u00eates partant ? Super ! N'h\u00e9sitez pas \u00e0 demander de l'aide \u00e0 la communaut\u00e9 Telmi !","title":"Ouvrir un store international Telmi"},{"location":"international/creer_un_store_international/#structure-dun-store-telmi","text":"Un store Telmi est basiquement un fichier JSON qui est appel\u00e9 sur le logiciel Telmi-Sync, ce dernier contient toutes les informations des packs d'histoire. Il est resynchronis\u00e9 \u00e0 chaque lancement du logiciel. Votre r\u00f4le est donc de faire en sorte que ce fichier JSON soit r\u00e9guli\u00e8rement mis \u00e0 jour et publiquement accessible. Pour cela, deux services sont donc exploit\u00e9s : Github et Deno. Github h\u00e9berge les histoires, les informations et met \u00e0 disposition le fichier JSON du store. Deno de son c\u00f4t\u00e9, sert uniquement \u00e0 d\u00e9clencher la mise \u00e0 jour quotidienne du fichier JSON.","title":"Structure d'un store Telmi"},{"location":"international/creer_un_store_international/#la-langue","text":"Pour commencer, identifiez le code ISO 639-1 du pays concern\u00e9 par votre langue. Par exemple \"FR\", pour la France. \u26a0\ufe0f Dans la suite de cette documentation, c'est le code \"EN\" qui sera pris en exemple, remplacez donc syst\u00e9matiquement ce dernier par votre propre code pays \u26a0\ufe0f","title":"La langue"},{"location":"international/creer_un_store_international/#creation-dune-organisation-github","text":"Identifiez-vous sur Github puis d\u00e9butez la cr\u00e9ation d'une organisation avec le nom : telmi-store-en Vous pouvez \u00e9galement ajouter quelques \u00e9minents membres de la communaut\u00e9 Telmi en soutient \ud83e\udd2a Commencez \u00e0 personaliser l'organisation : Nom : Telmi Store EN Une description traduite dans votre langue Le lien vers https://telmi.fr Une ic\u00f4ne personnalis\u00e9e avec le drapeau de votre langue, vous pouvez utiliser ce template XCF avec GIMP si besoin pour cr\u00e9er votre ic\u00f4ne. Votre organisation est pr\u00eate, il est temps d'initialiser le premier d\u00e9p\u00f4t .github , c'est un d\u00e9p\u00f4t de configuration sp\u00e9cial. Ajoutez ce dernier en acc\u00e8s public. Ce store doit \u00eatre initialis\u00e9 avec quelques fichiers, dossier et surtout la banni\u00e8re traduite dans votre langue. Pour faire ceci, reprenez la structure des d\u00e9p\u00f4ts existants, par exemple : https://github.com/telmi-store/.github/archive/refs/heads/main.zip https://github.com/telmi-store-en/.github/archive/refs/heads/main.zip https://github.com/telmi-store-cn/.github/archive/refs/heads/main.zip etc ... Pour concevoir la banni\u00e8re, vous pouvez utiliser ce template XCF avec GIMP si besoin pour la concevoir. Voici quelques instructions pour vous aidez \u00e0 initialiser ce d\u00e9p\u00f4t : # R\u00e9cup\u00e9rer le d\u00e9p\u00f4t vide sur en local git clone git@github.com:telmi-store-en/.github.git # Ajoutez-y vos fichiers mv -v mes-fichiers/* .github/ # Poussez les modifications cd .github git add --all git commit -m \"Init repo\" git branch -M main git remote add origin git@github.com:telmi-store-en/.github.git git push -u origin main Une fois votre d\u00e9p\u00f4t .github pr\u00eat, nous pouvons passer \u00e0 la mise en place du fichier GIST.","title":"Cr\u00e9ation d'une organisation Github"},{"location":"international/creer_un_store_international/#mise-en-place-dun-gist","text":"Github GIST est la fonctionnalit\u00e9 qui rendra votre fichier JSON visible publiquement. Rendez-vous sur https://gist.github.com pour commencer \u00e0 le cr\u00e9er en cliquant sur Create secret gist . Nommez-le telmi-store-en . Ajouter un simple point pour l'initialiser. Un fichier gistfile1.txt est cr\u00e9\u00e9, renommez-le telmi-interactive-en.json C'est pr\u00eat ! R\u00e9cup\u00e9rez l'URL publique en cliquant sur Share . Votre lien URL ressemblera \u00e0 quelque chose comme ceci : https://gist.github.com/heuzef/c2da96666a3a84397f19576d94d15a57 Ce lien comprend l'ID de votre GIST (ici c2da96666a3a84397f19576d94d15a57 dans cet exemple), notez-le pr\u00e9cieusement. Ainsi, le lien officiel de votre nouveau store sera donc structur\u00e9 ainsi : https://gist.githubusercontent.com/heuzef/c2da96666a3a84397f19576d94d15a57/raw/telmi-interactive-en.json Adaptez ce lien avec votre ID GIST et code pays, vous devriez ainsi pouvoir consulter votre fichier JSON (qui ne contient qu'un point \u00e0 ce stade). C'est \u00e9galement ce lien, que vous pourrez ajouter sur Telmi-Sync. C'est tout bon ? Super ! Nous allons pouvoir commencer la configuration de Deno, qui s'occupera de mettre \u00e0 jour quotidiennement ce fichier JSON. Mais avant cela, il faut lui donner l'autorisation de le faire, nous allons donc cr\u00e9er un Token d'acc\u00e8s d\u00e9di\u00e9. Pour cela, acc\u00e9der \u00e0 la gestion de vos Tokens. Vous pouvez directement commencer la cr\u00e9ation de votre Token via ce lien : https://github.com/settings/tokens/new Donnez-lui un nom parlant, par exemple telmi-store-gists et surtout sp\u00e9cifiez bien que ce dernier n'a pas de date d'expiration . Finalement, pour les permissions (Select scopes), sp\u00e9cifiez uniquement l'acc\u00e8s \u00e0 gist . \u00c0 la cr\u00e9ation, le Token appara\u00eetra en clair, notez-le pr\u00e9cieusement , car vous n'aurez plus acc\u00e8s \u00e0 ce dernier apr\u00e8s. Votre token ressemble \u00e0 ceci : github_pat_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx Ne partagez jamais ce dernier \u00e0 qui que ce soit.","title":"Mise en place d'un GIST"},{"location":"international/creer_un_store_international/#configuration-du-serveur-de-synchronisation-deno","text":"Deno est un service open-source d'ex\u00e9cution de code Javascript. Nous allons exploiter ce dernier car il dispose d'une fonction CRON , ce qui nous sera fort utile pour ex\u00e9cuter quotidiennement un script TS qui va : Parser les diff\u00e9rents d\u00e9p\u00f4ts de notre organisation sur Github En extraire toutes les informations des packs d'histoire G\u00e9n\u00e9rer le fichier JSON de notre store Pousser ce dernier sur GIST pour forcer son actualisation Vous pouvez donc commencer par vous authentifier sur le site de Deno (avec votre compte Github). Installez ensuite Deno sur votre machine : curl -fsSL https://deno.land/install.sh | sh Puis finalement, installez \u00e9galement l'outil de gestion (CLI) qui nous servira \u00e0 d\u00e9ployer notre projet : deno install -gArf jsr:@deno/deployctl export PATH=\"/home/$USER/.deno/bin:$PATH\" # Definir la variable PATH pour pouvoir executer deployctl Nous allons \u00e0 pr\u00e9sent initialiser le projet, voici \u00e0 quoi doit ressembler votre dossier ce travail : telmi-store-en \u2514\u2500\u2500 src \u2514\u2500\u2500 main.ts mkdir telmi-store-en mkdir telmi-store-en/src touch telmi-store-en/src/main.ts Cr\u00e9er votre fichier main.ts : const strFormat = (str) => str.replace(/[^\\u0020-\\ucfbf\\u000A]+/g, ' ').trim(), imageExists = (url) => { return new Promise((resolve, reject) => { fetch(url, { method: 'HEAD' }) .then((res) => { if (res.status !== 200) { return resolve(false) } resolve(true) }) .catch(() => { resolve(false) }) }) } Deno.serve(() => new Response('API d\\'histoires', { status: 200, headers: { 'content-type': 'text/html; charset=utf-8' } })) const githubToTelmi = async (gist, filename, repoURI, banner, background, link) => { let data = [] const repos = await (await fetch('https://api.github.com/orgs/' + repoURI + '/repos', { headers: { accept: 'application/json' } })).json() for (const repo of repos) { repo.thumbnail = 'https://raw.githubusercontent.com/' + repoURI + '/' + repo.name + '/main/thumbnail.jpg' if (await imageExists(repo.thumbnail)) { repo.releases = await (await fetch(repo.url + '/releases', { headers: { accept: 'application/json' } })).json() } else { repo.releases = [] } } data = repos.reduce( (acc, repo) => { if (!repo.releases.length || !repo.releases[0].assets.length) { return acc } const title = [...repo.description.matchAll(/^\\[([0-9]+)\\+](.*)\\(([A-Z]+)\\)$/g)] if (!title.length) { return acc } const url = repo.releases[0].assets.reduce( (acc, v) => { if (v.browser_download_url.substring(v.browser_download_url.length - 4) === '.zip') { return v.browser_download_url } return acc }, '' ) if (url === '') { return acc } const downloadCount = repo.releases.reduce( (acc, release) => release.assets.reduce((acc, v) => acc + v.download_count, acc), 0 ) const details = repo.releases[0].body.replace('\\r', '').split('\\n').reduce( (acc, line) => { if (line.substring(0, 1) !== '>') { acc.description = acc.description + '\\n' + line return acc } const colonPos = line.indexOf(':', 1) if (colonPos === -1) { acc.description = acc.description + '\\n' + line return acc } return { ...acc, [line.substring(1, colonPos).trim().toLowerCase()]: line.substring(colonPos + 1).trim() } }, { description: '' } ) return [ ...acc, Object.assign({ age: parseInt(strFormat(title[0][1]), 10), title: strFormat(title[0][2]), description: strFormat(details.description), thumbs: { small: repo.thumbnail, medium: repo.thumbnail }, download: strFormat(url), download_count: downloadCount, awards: details.awards !== undefined ? details.awards.substring(1).split('#').map((v) => strFormat(v.trim())) : [], created_at: repo.releases[repo.releases.length - 1].published_at, updated_at: repo.releases[0].published_at }, details.uuid !== undefined ? { uuid: details.uuid } : null, details.author !== undefined ? { author: details.author } : null, details.voice !== undefined ? { voice: details.voice } : null, details.designer !== undefined ? { designer: details.designer } : null, details.publisher !== undefined ? { publisher: details.publisher } : null, details.category !== undefined ? { category: details.category } : null, details.version !== undefined ? { version: details.version } : null, details.license !== undefined ? { license: details.license } : null ) ] }, data ) const dateIso = (new Date()).toISOString().split('T'), date = dateIso[0] + ' ' + dateIso[1].substring(0, 8) await fetch( 'https://api.github.com/gists/' + gist, { method: 'PATCH', headers: { Authorization: 'Bearer github_pat_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', Accept: 'application/vnd.github+json', 'X-GitHub-Api-Version': '2022-11-28', }, body: JSON.stringify({ description: 'Update ' + repoURI + ' (' + date + ')', files: { [filename]: { content: JSON.stringify({ banner: { image: banner, background, link }, data }) } } }) } ) } Deno.cron('telmi-interactive-en', '0 1,13 * * *', async () => { await githubToTelmi('c2da96666a3a84397f19576d94d15a57', 'telmi-interactive-en.json', 'telmi-store-en', 'https://raw.githubusercontent.com/telmi-store-en/.github/master/profile/banner-telmi.jpg', '#2e144b', 'https://discord.gg/ZTA5FyERbg') }) Adaptez ce fichier pour indiquer le Token (Ligne \"Authorization\"), l'ID GIST et le Code pays sur les derni\u00e8res lignes du script. Maintenant que votre fichier main.ts est pr\u00eat, nous pouvons effectuer le d\u00e9ploiement sur Deno : cd telmi-store-en deployctl deploy --prod --project=telmi-store-en --unstable src/main.ts Une demande d'autorisation est demand\u00e9e pour poursuivre. Si le d\u00e9ploiement r\u00e9ussis, vous devriez avoir un service accessible sur un domaine comme par exemple : https://telmi-store-en.deno.dev , mais \u00e9galement un fichier deno.json cr\u00e9\u00e9 par le d\u00e9ploiement. Finalement, RDV sur https://dash.deno.com pour visualiser l'\u00e9tat de l'ex\u00e9cution du script par CRON. Le statut \"Last Run\" doit indiquer \"Succeeded\".","title":"Configuration du serveur de synchronisation Deno"},{"location":"international/creer_un_store_international/#creation-dun-premier-pack-dhistoire","text":"\u26a0\ufe0f La cr\u00e9ation des packs d'histoire doit \u00eatre tr\u00e8s rigoureusement g\u00e9r\u00e9, autrement, l'ex\u00e9cution du script quotidien sur Deno \u00e9chouera si l'un de vos packs d'histoire est mal configur\u00e9, pouvant rendre alors votre store hors service \u26a0\ufe0f Pour que la synchronisation puisse fonctionner, il vous faut initialiser un premier pack d'histoire, afin de voir appara\u00eetre ce dernier sur telmi-sync. Donc c'est parti mon Telmi, retournons sur notre organisation Github, pour cr\u00e9er un nouveau d\u00e9p\u00f4t. Prenez exemple des d\u00e9p\u00f4ts d'histoire existants, par exemple : https://github.com/orgs/telmi-store/repositories Chaque d\u00e9p\u00f4t est structur\u00e9 tr\u00e8s pr\u00e9cis\u00e9ment, donc soyez tr\u00e8s rigoureux, mais globalement, vous y retrouverez la m\u00eame logique de structure avec quelques fichiers \u00e0 modifier. Puis, une fois votre d\u00e9p\u00f4t pr\u00eat, vous pourrez cr\u00e9er une \"Realease\" dans le menu du m\u00eame nom, qui contiendra votre pack d'histoire au format ZIP . Ajouter un nom avec la nomenclature des noms de pack (\u00e2ge, titre, langue) Cr\u00e9er un tag latest pour cette release Ajouter la description, attention au format du contenu, c'est ce dernier qui est analys\u00e9 sur le store Ajouter enfin le pack d'histoire au format ZIP Pour terminer, n'oubliez pas d'ajouter une description \u00e0 votre d\u00e9p\u00f4t, avec le nom du pack d'histoire utilisant la nomenclature des noms de pack (\u00e2ge, titre, langue), autrement, le script planifi\u00e9 par CRON sur Deno sera en \u00e9chec. C'est tout bon, v\u00e9rifiez bien le lendemain que votre nouveau pack d'histoire est correctement visible sur Telmi-Sync, puis r\u00e9p\u00e9ter l'op\u00e9ration pour chaque pack d'histoire \ud83d\udcaa \u26a0\ufe0f Soyez prudent concernant les droits d'auteur, aucun pack d'histoire ill\u00e9gal ne doit \u00eatre mis \u00e0 disposition du public \u26a0\ufe0f","title":"Cr\u00e9ation d'un premier pack d'histoire"},{"location":"international/stores_internationaux/","text":"Telmi voyage \u00e0 l'international Telmi s'ouvre aux autres langues et n'est pas exclusif \u00e0 la France ! Si vous souhaitez offrir a votre enfant du contenu dans d'autres langue, vous pouvez ajouter les Stores d'histoire d\u00e9di\u00e9s. Pour ajouter un nouveau Store dans Telmi-Sync, cliquez sur le bouton \"+ Ajouter un store\" dans le menu Stores. \ud83c\udff3\ufe0f Pays URL Mainteneurs \ud83c\uddeb\ud83c\uddf7 FR https://gist.githubusercontent.com/DantSu/49ed776755f3a01c995e78e3fd1cb79f/raw/telmi-interactive.json DantSu \ud83c\uddec\ud83c\udde7 EN https://gist.githubusercontent.com/heuzef/c2da96666a3a84397f19576d94d15a57/raw/telmi-interactive-en.json Heuzef \ud83c\udde8\ud83c\uddf3 CN https://gist.githubusercontent.com/heuzef/eb352efaf78c1f1cbd5e7739f5d5e3f3/raw/telmi-interactive-cn.json Heuzef La communaut\u00e9 recherche des personnes bilingues motiv\u00e9es pour cr\u00e9er et maintenir des nouveaux stores dans de nouvelles langues. Prenez contact avec la communaut\u00e9 sur Discord !","title":"Stores internationaux"},{"location":"international/stores_internationaux/#telmi-voyage-a-linternational","text":"Telmi s'ouvre aux autres langues et n'est pas exclusif \u00e0 la France ! Si vous souhaitez offrir a votre enfant du contenu dans d'autres langue, vous pouvez ajouter les Stores d'histoire d\u00e9di\u00e9s. Pour ajouter un nouveau Store dans Telmi-Sync, cliquez sur le bouton \"+ Ajouter un store\" dans le menu Stores. \ud83c\udff3\ufe0f Pays URL Mainteneurs \ud83c\uddeb\ud83c\uddf7 FR https://gist.githubusercontent.com/DantSu/49ed776755f3a01c995e78e3fd1cb79f/raw/telmi-interactive.json DantSu \ud83c\uddec\ud83c\udde7 EN https://gist.githubusercontent.com/heuzef/c2da96666a3a84397f19576d94d15a57/raw/telmi-interactive-en.json Heuzef \ud83c\udde8\ud83c\uddf3 CN https://gist.githubusercontent.com/heuzef/eb352efaf78c1f1cbd5e7739f5d5e3f3/raw/telmi-interactive-cn.json Heuzef La communaut\u00e9 recherche des personnes bilingues motiv\u00e9es pour cr\u00e9er et maintenir des nouveaux stores dans de nouvelles langues. Prenez contact avec la communaut\u00e9 sur Discord !","title":"Telmi voyage \u00e0 l'international"}]}